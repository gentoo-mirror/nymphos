From 9ded0778ee548fd8837bb35bdb5617cae0a791d1 Mon Sep 17 00:00:00 2001
From: Gaming4JC <g4jc@hyperbola.info>
Date: Wed, 19 Jun 2019 22:52:25 -0400
Subject: [PATCH] [Basilisk] Fix packaging when sync is not built

Packaging will fail due to missing ifdefs when --disable-sync is passed in .mozconfig. This fixes that issue by including the missing ifdefs.
---
 application/basilisk/installer/package-manifest.in | 4 ++++
 application/basilisk/locales/Makefile.in           | 2 ++
 application/basilisk/locales/l10n.ini              | 2 ++
 3 files changed, 8 insertions(+)

diff --git a/application/basilisk/installer/package-manifest.in b/application/basilisk/installer/package-manifest.in
index 22655bc337..71f7759041 100644
--- a/application/basilisk/installer/package-manifest.in
+++ b/application/basilisk/installer/package-manifest.in
@@ -477,8 +477,10 @@
 @RESPATH@/browser/components/SelfSupportService.manifest
 @RESPATH@/browser/components/SelfSupportService.js
 #endif
+#ifdef MOZ_SERVICES_SYNC
 @RESPATH@/components/SyncComponents.manifest
 @RESPATH@/components/Weave.js
+#endif
 @RESPATH@/components/CaptivePortalDetectComponents.manifest
 @RESPATH@/components/captivedetect.js
 @RESPATH@/components/servicesComponents.manifest
@@ -629,7 +631,9 @@
 @RESPATH@/defaults/pref/channel-prefs.js
 
 ; Services (gre) prefs
+#ifdef MOZ_SERVICES_SYNC
 @RESPATH@/defaults/pref/services-sync.js
+#endif
 
 ; [Layout Engine Resources]
 ; Style Sheets, Graphics and other Resources used by the layout engine.
diff --git a/application/basilisk/locales/Makefile.in b/application/basilisk/locales/Makefile.in
index b8aee0f146..527922b111 100644
--- a/application/basilisk/locales/Makefile.in
+++ b/application/basilisk/locales/Makefile.in
@@ -97,7 +97,9 @@ DEFINES += -DBOOKMARKS_INCLUDE_DIR=$(dir $(call MERGE_FILE,profile/bookmarks.inc
 libs-%:
 	$(NSINSTALL) -D $(DIST)/install
 	@$(MAKE) -C $(DEPTH)/toolkit/locales libs-$* XPI_ROOT_APPID='$(XPI_ROOT_APPID)'
+ifdef MOZ_SERVICES_SYNC
 	@$(MAKE) -C $(DEPTH)/services/sync/locales AB_CD=$* XPI_NAME=locale-$*
+endif
 	@$(MAKE) -C $(DEPTH)/extensions/spellcheck/locales AB_CD=$* XPI_NAME=locale-$*
 # 	@$(MAKE) -C ../extensions/pocket/locale AB_CD=$* XPI_NAME=locale-$*
 	@$(MAKE) -C $(DEPTH)/intl/locales AB_CD=$* XPI_NAME=locale-$*
diff --git a/application/basilisk/locales/l10n.ini b/application/basilisk/locales/l10n.ini
index f1d22c259b..78bafe8ca8 100644
--- a/application/basilisk/locales/l10n.ini
+++ b/application/basilisk/locales/l10n.ini
@@ -16,7 +16,9 @@ dirs = browser
 # non-central apps might want to use %(topsrcdir)s here, or other vars
 # RFE: that needs to be supported by compare-locales, too, though
 toolkit = toolkit/locales/l10n.ini
+#ifdef MOZ_SERVICES_SYNC
 services_sync = services/sync/locales/l10n.ini
+#endif
 
 [extras]
 dirs = extensions/spellcheck
