From 0d814f1addb52446607e958da683bb9e939a8e4e Mon Sep 17 00:00:00 2001
From: neeshy <neeshy@tfwno.gf>
Date: Mon, 10 Jun 2024 23:58:29 -0400
Subject: [PATCH] Revert "BUILD(cmake): Always use DBus on Linux(-like)
 systems"

This reverts commit a4cd707128087e5c39dd72d8ae83cec6d88719d0.
---
 docs/dev/build-instructions/cmake_options.md | 5 +++++
 src/CMakeLists.txt                           | 2 ++
 src/mumble/CMakeLists.txt                    | 2 +-
 3 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/docs/dev/build-instructions/cmake_options.md b/docs/dev/build-instructions/cmake_options.md
index 3ddb5bcba..8d5d90060 100644
--- a/docs/dev/build-instructions/cmake_options.md
+++ b/docs/dev/build-instructions/cmake_options.md
@@ -99,6 +99,11 @@ Whether to include the PostgreSQL database tests (requires special setup)
 Whether to include the SQLite database tests
 (Default: ON)
 
+### dbus
+
+Build support for DBus.
+(Default: ON)
+
 ### debug-dependency-search
 
 Prints extended information during the search for the needed dependencies
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index ded59a214..bef537cbd 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -12,6 +12,8 @@ option(qssldiffiehellmanparameters "Build support for custom Diffie-Hellman para
 
 option(zeroconf "Build support for zeroconf (mDNS/DNS-SD)." ON)
 
+option(dbus "Build support for DBus." ON)
+
 option(tracy "Enable the tracy profiler." OFF)
 
 option(bundled-gsl "Use the bundled GSL version instead of looking for one on the system" ON)
diff --git a/src/mumble/CMakeLists.txt b/src/mumble/CMakeLists.txt
index c383c6568..7a25253e2 100644
--- a/src/mumble/CMakeLists.txt
+++ b/src/mumble/CMakeLists.txt
@@ -835,7 +835,7 @@ if(NOT update)
 	target_compile_definitions(mumble_client_object_lib PUBLIC "NO_UPDATE_CHECK")
 endif()
 
-if(NOT WIN32 AND NOT APPLE)
+if(dbus AND NOT WIN32 AND NOT APPLE)
 	find_pkg(Qt6 COMPONENTS DBus REQUIRED)
 
 	target_sources(mumble_client_object_lib
